# 第14章：策略游戏测试

## 学习目标

本章深入探讨大型策略游戏（如维多利亚、三国志、文明、欧陆风云等）的测试方法论。这类游戏以其复杂的经济系统、深度的外交机制、多层次的AI决策和历史模拟为特点，对测试提出了独特的挑战。通过本章学习，你将掌握：

- 理解并验证复杂经济模型的数学基础与平衡性
- 分析外交系统中的数值权重与决策树
- 调校AI难度曲线，确保不同水平玩家的游戏体验
- 平衡历史真实性与游戏可玩性之间的张力
- 设计长期游戏进程的自动化测试方案

## 14.1 复杂经济模型验证

### 14.1.1 经济循环的数学建模

策略游戏的经济系统通常包含多个相互作用的子系统：资源生产、消费、贸易、税收、通货膨胀等。验证这些系统需要建立严格的数学模型。大型策略游戏如《维多利亚3》的经济系统可能包含上百种商品和数千条贸易路线，形成极其复杂的经济网络。

```
资源循环图示：
    [原材料] ──生产──> [中间产品] ──加工──> [最终产品]
        ↑                    │                    │
        │                    │                    ↓
    [回收/损耗] <────────────┴──────────── [消费/出口]
        │                                        │
        └──────────── [技术进步] ────────────────┘
```

核心验证公式：

$$\Delta R_t = P_t - C_t + I_t - E_t + \epsilon_t$$

其中：
- $R_t$：时刻t的资源存量
- $P_t$：生产量（受劳动力、技术、资本影响）
- $C_t$：消费量（分为必需消费和奢侈消费）
- $I_t$：进口量（受贸易协定、运输成本影响）
- $E_t$：出口量（受国际需求、汇率影响）
- $\epsilon_t$：随机扰动项（战争、灾害、政策变动）

**生产函数的深层建模**：

采用柯布-道格拉斯生产函数的扩展形式：

$$P_t = A_t \cdot L_t^\alpha \cdot K_t^\beta \cdot R_t^\gamma \cdot e^{\delta \cdot Tech_t}$$

其中：
- $A_t$：全要素生产率
- $L_t$：劳动投入（考虑技能水平）
- $K_t$：资本投入
- $R_t$：自然资源投入
- $Tech_t$：技术水平
- $\alpha + \beta + \gamma < 1$：规模报酬递减

**消费函数的分层设计**：

基于马斯洛需求层次理论，将消费分为多个优先级：

$$C_t = C_{basic} + \theta_1 \cdot C_{comfort} + \theta_2 \cdot C_{luxury}$$

其中$\theta_i$为收入弹性系数，随人均GDP变化：
- 低收入：$\theta_1 \approx 0.2, \theta_2 \approx 0.05$
- 中收入：$\theta_1 \approx 0.5, \theta_2 \approx 0.2$
- 高收入：$\theta_1 \approx 0.7, \theta_2 \approx 0.5$

**跨期优化问题**：

玩家或AI需要解决的动态规划问题：

$$\max \sum_{t=0}^{T} \beta^t U(C_t, L_t, G_t)$$

约束条件：
$$K_{t+1} = (1-\delta)K_t + I_t$$
$$B_{t+1} = (1+r)B_t + G_t - T_t$$

其中$U$为效用函数，$\beta$为贴现因子，$G_t$为政府支出，$T_t$为税收。

### 14.1.2 供需平衡与价格机制

价格形成机制的验证需要检查供需曲线的交点稳定性。在复杂策略游戏中，价格不仅影响经济，还会触发社会动荡、政治变革等连锁反应：

$$P = P_{base} \times \left(\frac{D}{S}\right)^\alpha \times (1 + \beta \cdot \text{modifier})$$

关键测试点：
- 极端供需比例下的价格上下限（防止负价格或无限大）
- 价格弹性系数$\alpha$的合理范围（0.5-2.0）
- 外部修正因子的叠加效应（战争、禁运、技术突破）

**动态均衡的收敛性分析**：

使用蛛网模型检验价格波动是否收敛：

$$P_{t+1} = f(Q_t^s), \quad Q_{t+1}^s = g(P_t)$$

收敛条件：
$$\left|\frac{df}{dQ} \cdot \frac{dg}{dP}\right| < 1$$

当这个条件不满足时，市场会出现周期性震荡或发散，需要引入稳定机制：
- 价格粘性：$P_t = \omega P_{t-1} + (1-\omega)P_{market}$
- 政府干预：设置价格上下限或补贴
- 库存缓冲：使用战略储备平抑价格

**多市场一般均衡**：

当存在多个相互关联的市场时，需要求解联立方程组：

$$\begin{cases}
D_i(P_1, P_2, ..., P_n) = S_i(P_1, P_2, ..., P_n) \\
\text{for } i = 1, 2, ..., n
\end{cases}$$

使用Brouwer不动点定理保证均衡存在，但计算复杂度为$O(n^3)$，需要优化算法：
- 分块求解：将商品分组，先求解组内均衡
- 迭代逼近：使用Jacobi或Gauss-Seidel方法
- 并行计算：利用GPU加速大规模均衡计算

### 14.1.3 产业链完整性检验

产业链测试需要验证从基础资源到高级产品的完整转化路径。现代策略游戏的产业链可能包含数十个环节，任何断链都会导致经济崩溃：

```
产业链示例（钢铁工业）：
铁矿 ──> 生铁 ──> 钢材 ──> 机械/武器
  │         │         │         │
  ↓         ↓         ↓         ↓
煤炭 ──> 焦炭 ──> 合金钢 ──> 高级装备
  │         │         │         │
  ↓         ↓         ↓         ↓
运输 ──> 电力 ──> 化工 ──> 电子产品
```

**投入产出矩阵分析**：

使用Leontief投入产出模型：

$$X = (I - A)^{-1} \cdot Y$$

其中：
- $X$：总产出向量
- $A$：技术系数矩阵（$a_{ij}$表示生产1单位j产品需要i产品的数量）
- $Y$：最终需求向量
- $I$：单位矩阵

**关键路径识别**：

使用图论算法识别产业链中的关键路径：

$$CPM = \max_{path} \sum_{edge \in path} weight(edge)$$

测试重点：
- 最长路径（技术复杂度）
- 最短路径（资源效率）
- 割点识别（单点故障）
- 强连通分量（循环依赖）

**瓶颈资源的动态识别**：

$$Bottleneck_i = \frac{Demand_i}{Supply_i} \times Criticality_i$$

其中关键度计算：
$$Criticality_i = \sum_{j} \frac{\partial Output_j}{\partial Input_i} \times Value_j$$

测试矩阵应覆盖：
- 每个节点的输入输出比例（效率测试）
- 瓶颈资源识别（压力测试）
- 替代路径的效率对比（冗余性测试）
- 科技解锁对产业链的影响（升级测试）
- 供应链韧性（断链恢复时间）

**产业升级路径验证**：

```
技术演进树：
手工业 ──科技1──> 工场手工业 ──科技2──> 机械化生产
  效率:1x           效率:3x              效率:10x
  成本:低           成本:中              成本:高
  
验证点：
- 升级成本回收期
- 并行生产的效率对比
- 强制升级vs自然演进
```

### 14.1.4 通货系统与财政平衡

货币系统测试的核心方程：

$$M \cdot V = P \cdot Q$$

- $M$：货币供应量
- $V$：货币流通速度
- $P$：价格水平
- $Q$：实际产出

**动态通胀模型**：

费雪方程的动态扩展：

$$\pi_t = \mu_t - g_t + v_t$$

其中：
- $\pi_t$：通货膨胀率
- $\mu_t$：货币供应增长率
- $g_t$：实际产出增长率
- $v_t$：流通速度变化率

**财政乘数效应测试**：

政府支出对GDP的影响：

$$\Delta Y = \frac{1}{1 - c(1-t) + m} \cdot \Delta G$$

其中：
- $c$：边际消费倾向（0.6-0.8）
- $t$：税率（0.2-0.4）
- $m$：进口倾向（0.1-0.3）
- 乘数典型值：1.2-2.5

**拉弗曲线验证**：

税收收入与税率的关系：

$$T = t \cdot Y(t) = t \cdot Y_0 \cdot (1 - \alpha \cdot t^2)$$

最优税率：
$$t^* = \frac{1}{\sqrt{3\alpha}}$$

测试场景：
- 税率0%：无政府收入，经济自由发展
- 税率30%：平衡点，收入与增长兼顾
- 税率60%：高福利高税收，增长放缓
- 税率100%：经济崩溃，地下经济盛行

**汇率形成机制**：

购买力平价理论：
$$E = \frac{P_{domestic}}{P_{foreign}} \times (1 + r_{diff}) \times \psi$$

其中$\psi$为心理预期因子（0.8-1.2）

**债务可持续性分析**：

$$\frac{dD}{dt} = rD + PD - PB$$

稳态债务率：
$$d^* = \frac{pb}{g - r}$$

危机阈值：
- 发达国家：债务/GDP > 90%
- 新兴市场：债务/GDP > 60%
- 利息支出/财政收入 > 20%

测试重点：
1. 通货膨胀率的长期稳定性（目标2-3%）
2. 税收政策对经济增长的影响曲线（拉弗曲线）
3. 政府支出乘数效应（1.5-2.0）
4. 国际贸易对汇率的影响（J曲线效应）
5. 债务雪球效应的触发条件
6. 量化宽松的副作用

## 14.2 外交系统数值权重

### 14.2.1 关系值计算模型

外交关系通常由多个因素加权计算，形成复杂的国际关系网络：

$$R_{ij} = \sum_{k=1}^{n} w_k \cdot f_k(i,j) + \text{base}_{ij} + \text{random}$$

**详细因素分解**：

1. **地缘政治因素**：
   - 边界摩擦：$f_{border} = -10 \times \text{disputed\_provinces}$
   - 距离衰减：$f_{distance} = \max(0, 50 - 5 \times \text{distance})$
   - 地理屏障：$f_{terrain} = 20 \times \text{mountain\_penalty}$

2. **经济因素**：
   - 贸易往来：$f_{trade} = \min(100, 10 \times \sqrt{\text{trade\_volume}})$
   - 资源竞争：$f_{resource} = -30 \times \text{overlap\_ratio}$
   - 经济依赖：$f_{depend} = 50 \times \text{import\_ratio}$

3. **意识形态因素**：
   - 政体差异：$f_{gov} = 30 \times (1 - |\text{gov}_i - \text{gov}_j|/10)$
   - 宗教冲突：$f_{religion} = \text{same} ? +20 : -40$
   - 文化亲近：$f_{culture} = 25 \times \text{similarity}$

4. **历史因素**：
   - 历史恩怨：$f_{history} = \sum \text{event\_modifier} \times e^{-\lambda t}$
   - 战争记忆：$f_{war} = -100 \times e^{-0.1 \times \text{years\_since}}$
   - 联盟历史：$f_{ally} = 50 \times \text{alliance\_duration}/10$

5. **当前局势**：
   - 共同敌人：$f_{enemy} = 75 \times \max(\text{threat}_i, \text{threat}_j)$
   - 势力平衡：$f_{balance} = -40 \times |\text{power}_i - \text{power}_j|$
   - 外交立场：$f_{stance} = \text{modifier\_from\_diplomatic\_stance}$

**权重动态调整**：

权重随游戏时代和文明特性变化：

$$w_k(t, civ) = w_{base} \times \eta_{era}(t) \times \xi_{civ}(civ)$$

例如：
- 古代：重视地理因素（$\eta_{geo} = 1.5$）
- 中世纪：重视宗教因素（$\eta_{religion} = 2.0$）
- 近代：重视贸易因素（$\eta_{trade} = 1.8$）
- 现代：重视意识形态（$\eta_{ideology} = 2.5$）

### 14.2.2 外交行动决策树

```
外交决策流程：
         [评估关系值]
              │
    ┌─────────┼─────────┐
    │         │         │
  R<-50    -50≤R≤50    R>50
    │         │         │
  [敌对]   [中立]    [友好]
    │         │         │
可选行动： 可选行动： 可选行动：
-宣战     -改善关系  -结盟
-禁运     -贸易协定  -军事同盟
-谴责     -互不侵犯  -经济一体化
```

### 14.2.3 多边外交平衡

多国博弈中的纳什均衡验证：

$$U_i(s_i^*, s_{-i}^*) \geq U_i(s_i, s_{-i}^*) \quad \forall s_i \in S_i$$

测试场景：
- 三角外交的稳定性
- 联盟体系的连锁反应
- 势力平衡的动态演化
- 外交孤立的破局策略

### 14.2.4 威望与影响力系统

威望积累公式：

$$\text{Prestige}_t = \text{Prestige}_{t-1} \times \text{decay} + \sum \text{gains}_t - \sum \text{losses}_t$$

影响力传播模型（基于图论）：

$$I_j = \sum_{i \in N(j)} \frac{I_i}{d_i} \times w_{ij}$$

- $I_j$：节点j的影响力
- $N(j)$：j的邻居节点集合
- $d_i$：节点i的出度
- $w_{ij}$：边权重

## 14.3 AI难度曲线调校

### 14.3.1 AI能力参数化

AI难度通常通过多个维度的参数调节：

```
难度参数矩阵：
              简单  普通  困难  疯狂
资源加成      0.8   1.0   1.2   1.5
决策延迟(秒)  3.0   2.0   1.0   0.5
战术复杂度    1     3     5     7
战略深度      2     4     6     8
作弊程度      无    轻微  中等  严重
```

### 14.3.2 自适应难度算法

动态难度调整（DDA）公式：

$$D_{t+1} = D_t + k \cdot (P_{target} - P_{actual})$$

- $D_t$：当前难度值
- $P_{target}$：目标表现（如胜率50%）
- $P_{actual}$：实际表现
- $k$：学习率

### 14.3.3 AI决策权重矩阵

```
AI决策优先级（权重）：
                  经济AI  军事AI  外交AI  科技AI
生存威胁应对        20      80      60      10
扩张机会评估        40      60      30      20
内部发展优化        70      20      10      50
长期战略规划        50      40      70      80
```

### 14.3.4 学习曲线验证

新手玩家的学习曲线模型：

$$S(t) = S_{max} \cdot (1 - e^{-\lambda t})$$

- $S(t)$：技能水平
- $S_{max}$：最大技能上限
- $\lambda$：学习速率
- $t$：游戏时间

测试指标：
- 前10小时的挫败率
- 50小时后的掌握度
- 100小时的深度理解
- 重玩价值曲线

## 14.4 历史准确性vs游戏性平衡

### 14.4.1 历史事件触发条件

历史事件的概率模型：

$$P(\text{event}) = P_{base} \times \prod_{i} m_i(c_i)$$

其中$m_i(c_i)$为条件修正：
- 年代符合度（0.1 到 2.0）
- 前置条件满足度（0 或 1）
- 玩家干预程度（0.5 到 1.5）
- 随机因子（0.8 到 1.2）

### 14.4.2 非历史路线的平衡性

替代历史的可行性评分：

$$V = \alpha \cdot \text{Historical} + \beta \cdot \text{Gameplay} + \gamma \cdot \text{Balance}$$

约束条件：
- $\alpha + \beta + \gamma = 1$
- 典型值：$\alpha = 0.3, \beta = 0.5, \gamma = 0.2$

### 14.4.3 技术发展树的时代锁

```
技术树时代门槛：
古典时代 ──需要3项──> 中世纪 ──需要5项──> 文艺复兴
   │                      │                    │
   ├─农业                 ├─工程学              ├─印刷术
   ├─冶金                 ├─数学               ├─航海
   └─文字                 └─哲学               └─火药
```

### 14.4.4 国家特色与平衡

国力评分公式：

$$\text{Power} = \sqrt[n]{\prod_{i=1}^{n} S_i^{w_i}}$$

- $S_i$：各项能力分值
- $w_i$：权重系数
- $n$：能力维度数

平衡性验证：
- 每个国家至少一个S级特长
- 不超过两个F级短板
- 总评分标准差 < 10%

## 14.5 长期游戏进程测试

### 14.5.1 时间尺度与游戏节奏

游戏进程的阶段划分：

```
游戏阶段时间分配：
开局探索期（0-20%）：建立基础，了解环境
发展扩张期（20-50%）：快速增长，冲突开始
中期博弈期（50-75%）：大国对抗，联盟形成
后期决战期（75-100%）：最终对决，胜负已定
```

### 14.5.2 滚雪球效应控制

反馈循环的数学描述：

$$X_{t+1} = X_t \cdot (1 + r) \cdot f(X_t)$$

其中$f(X_t)$为抑制函数：
- 线性抑制：$f(X) = \max(0, 1 - kX)$
- 对数抑制：$f(X) = \frac{1}{\log(X + e)}$
- sigmoid抑制：$f(X) = \frac{2}{1 + e^{kX}} $

### 14.5.3 后期游戏的趣味性维持

后期挑战机制：
- 内部叛乱概率：$P_{rebel} = k \cdot \text{size}^2$
- 外部威胁强度：$T = T_{base} \cdot (1 + 0.1t)$
- 资源枯竭速度：$R_t = R_0 \cdot e^{-\lambda t}$

### 14.5.4 存档兼容性与版本迭代

存档数据结构验证：

```
存档版本兼容性矩阵：
         v1.0  v1.1  v1.2  v2.0
v1.0存档   ✓     ✓     ✓     ✗
v1.1存档   ✗     ✓     ✓     ✓
v1.2存档   ✗     ✗     ✓     ✓
v2.0存档   ✗     ✗     ✗     ✓
```

迁移测试要点：
- 数据完整性校验
- 游戏平衡性保持
- 新特性的追溯应用
- 性能影响评估

## 本章小结

策略游戏测试是游戏测试领域中最具挑战性的分支之一。本章介绍的核心概念包括：

1. **经济模型验证**：通过数学建模验证资源循环、供需平衡、产业链完整性和通货系统的稳定性。关键公式$\Delta R_t = P_t - C_t + I_t - E_t + \epsilon_t$描述了资源流动的基本规律。

2. **外交系统权重**：外交关系的多因素加权模型$R_{ij} = \sum w_k \cdot f_k(i,j)$，以及基于博弈论的多边外交平衡分析。

3. **AI难度调校**：通过参数化能力、自适应算法（$D_{t+1} = D_t + k \cdot (P_{target} - P_{actual})$）和决策权重矩阵实现不同难度的AI表现。

4. **历史与游戏性平衡**：使用概率模型控制历史事件触发，通过评分系统（$V = \alpha \cdot \text{Historical} + \beta \cdot \text{Gameplay} + \gamma \cdot \text{Balance}$）平衡真实性与可玩性。

5. **长期进程控制**：通过抑制函数控制滚雪球效应，设计后期挑战机制维持游戏趣味性。

掌握这些方法论，可以有效提升大型策略游戏的测试质量，确保复杂系统的平衡性和长期可玩性。

## 常见陷阱与错误 (Gotchas)

### 1. 经济系统的隐性通胀
**问题**：资源生产效率提升但消费需求不变，导致后期资源严重过剩。
**解决**：引入动态消费系数或资源衰减机制。

### 2. 外交死锁
**问题**：多个AI陷入互相敌对但实力均衡的状态，游戏陷入僵局。
**解决**：加入破局机制，如定期事件、第三方势力介入。

### 3. AI作弊过于明显
**问题**：高难度AI直接获得资源而非提升决策质量，破坏沉浸感。
**解决**：优先提升AI决策深度，资源加成保持在20%以内。

### 4. 历史决定论陷阱
**问题**：过度强调历史准确性，导致每局游戏进程雷同。
**解决**：历史事件触发概率不超过70%，保留足够随机性。

### 5. 数值膨胀失控
**问题**：游戏后期数值增长过快，整数溢出或显示问题。
**解决**：使用对数增长或软上限，定期重新标定基准值。

### 6. 测试周期过长
**问题**：完整测试一局游戏需要几十小时。
**解决**：开发加速模式、自动化测试脚本、分阶段测试策略。

### 7. 平衡性版本震荡
**问题**：每次调整导致新的不平衡，陷入"打地鼠"困境。
**解决**：建立完整的数值模型，批量调整相关参数。

### 8. 存档兼容性噩梦
**问题**：每次更新都破坏旧存档，激怒玩家。
**解决**：严格的版本管理，向后兼容至少两个大版本。

## 练习题

### 练习14.1：经济循环验证
设计一个测试用例，验证以下经济循环是否平衡：
- 农民生产粮食，消耗工具
- 工匠生产工具，消耗粮食和铁
- 矿工生产铁，消耗粮食
- 初始条件：100农民、20工匠、10矿工

**提示**：建立投入产出矩阵，计算稳态解。

<details>
<summary>参考答案</summary>

建立投入产出方程组：
- 粮食生产：$100 \times 2 = 200$单位/回合
- 粮食消耗：$(100 + 20 + 10) \times 1 + 20 \times 2 = 170$单位/回合
- 工具生产：$20 \times 3 = 60$单位/回合
- 工具消耗：$100 \times 0.5 = 50$单位/回合
- 铁生产：$10 \times 5 = 50$单位/回合
- 铁消耗：$20 \times 2 = 40$单位/回合

系统平衡，各资源均有盈余。可通过调整人口比例优化效率。
</details>

### 练习14.2：外交关系预测
给定三个国家A、B、C的初始关系值：
- A-B: +30
- B-C: -40
- A-C: +10

如果A和C结盟（关系+50），预测对B的影响。

**提示**：考虑三角外交的连锁反应。

<details>
<summary>参考答案</summary>

A-C结盟后：
- A-C: +60
- A、C共同对B的压力增加
- B可能采取的策略：
  1. 改善与A的关系（成功率30%）
  2. 寻求第四方D的支持（成功率50%）
  3. 先发制人攻击C（风险高）
- 预期B-A关系恶化至0，B-C关系恶化至-60
- 系统趋向两极对抗格局
</details>

### 练习14.3：AI难度标定
设计一个实验，确定AI在"普通"难度下的合理胜率范围。

**提示**：考虑不同技能水平的玩家群体。

<details>
<summary>参考答案</summary>

实验设计：
1. 招募30名测试者（新手10、中级10、高手10）
2. 每人进行5局对战
3. 统计胜率分布：
   - 新手组：期望胜率20-40%
   - 中级组：期望胜率40-60%
   - 高手组：期望胜率60-80%
4. 计算加权平均：目标总体胜率45-55%
5. 调整参数直到达到目标区间
</details>

### 练习14.4：历史事件概率计算
某历史事件基础触发概率30%，需要满足：
- 年份1850-1870（满足时×1.5）
- 拥有蒸汽机技术（满足时×2.0）
- 与英国关系>50（满足时×1.2）

计算1860年，拥有蒸汽机，与英国关系60时的触发概率。

**提示**：使用条件概率乘法。

<details>
<summary>参考答案</summary>

$P = 0.3 \times 1.5 \times 2.0 \times 1.2 = 1.08$

由于概率不能超过100%，实际触发概率为100%（必定触发）。

这提示需要重新调整基础概率或修正系数，建议：
- 降低基础概率至20%
- 或使用加法模型而非乘法
- 或设置修正系数上限
</details>

### 练习14.5：滚雪球效应评估
某国每回合领土扩张10%，军力增长8%，经济增长12%。设计一个抑制函数，使其在达到初始规模5倍时增长率降至2%。

**提示**：使用指数衰减函数。

<details>
<summary>参考答案</summary>

设计抑制函数：$f(x) = 0.1 \times e^{-0.5(x-1)}$ 当$x > 1$

验证：
- $x = 1$时：$f(1) = 0.1$（初始增长10%）
- $x = 5$时：$f(5) = 0.1 \times e^{-2} \approx 0.0135$（约1.35%）

应用到三个维度：
- 领土：$10\% \times f(x)$
- 军力：$8\% \times f(x)$  
- 经济：$12\% \times f(x)$

当达到5倍规模时，增长率分别降至1.35%、1.08%、1.62%，接近目标。
</details>

### 练习14.6：版本更新影响分析
游戏从v1.0更新到v2.0，修改了战斗公式：
- 旧：伤害 = 攻击力 - 防御力
- 新：伤害 = 攻击力 × (100/(100+防御力))

分析对游戏平衡的影响。

**提示**：比较不同攻防数值下的伤害变化。

<details>
<summary>参考答案</summary>

影响分析：
1. 低防御单位（防御<50）：受到伤害增加
2. 高防御单位（防御>100）：受到伤害大幅降低
3. 防御收益递减，堆防御不再线性有效
4. 需要调整的内容：
   - 防御装备价值需重新评估
   - 高防御单位成本应降低
   - 穿甲类技能价值提升
   - PvE内容难度需重新调整
5. 建议提供数值转换工具帮助玩家适应
</details>

### 练习14.7：性能瓶颈定位
某策略游戏在游戏后期（>200回合）出现明显卡顿。设计一个测试方案定位问题。

**提示**：分析可能的性能瓶颈来源。

<details>
<summary>参考答案</summary>

测试方案：
1. **数据量分析**：
   - 统计单位数量、外交关系数、贸易路线数
   - 识别$O(n^2)$或更高复杂度的算法

2. **分模块测试**：
   - 禁用AI决策，测试渲染性能
   - 禁用渲染，测试逻辑计算
   - 逐个禁用子系统定位瓶颈

3. **性能采样**：
   - CPU使用率分布
   - 内存分配情况
   - I/O操作频率

4. **常见问题检查**：
   - 路径寻找算法效率
   - 视野计算优化
   - 事件队列膨胀
   - 内存泄漏累积

5. **优化建议**：
   - 实施LOD（细节层次）系统
   - 异步处理非关键计算
   - 定期清理历史数据
</details>

### 练习14.8：多人游戏平衡性（挑战题）
设计一个4人对战地图，满足：
- 每个出生点资源总value相等
- 任意两家联盟不能完全压制另外两家
- 地理位置各有优劣

**提示**：考虑不对称平衡设计。

<details>
<summary>参考答案</summary>

地图设计方案：

```
        [北方-山地防守型]
              金属+
         /            \
[西方-平原扩张型]  [东方-河流贸易型]
    食物+              金币+
         \            /
        [南方-海岸科技型]
              科研+
```

平衡要素：
1. **资源分配**：
   - 每家基础资源价值1000点
   - 特色资源各占20%加成
   - 中立资源等距分布

2. **地理优劣**：
   - 北：易守难攻但扩张困难
   - 南：科技优势但早期脆弱
   - 东：贸易富裕但军事较弱
   - 西：扩张便利但防守困难

3. **联盟制衡**：
   - 对角线联盟距离远，协同难
   - 相邻联盟易配合但资源类型重复
   - 设计关键战略点阻止一边倒

4. **动态平衡机制**：
   - 领先惩罚：领先者维护成本增加
   - 落后补偿：落后者获得事件加成
   - 设置全局目标促进临时联盟变化
</details>

---

*第14章完成。策略游戏测试需要深厚的系统思维和数学功底，建议结合实际项目反复实践这些方法。*